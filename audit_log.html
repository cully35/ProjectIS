<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>DataTable Example</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/buttons/1.7.1/css/buttons.dataTables.min.css"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script
      type="text/javascript"
      charset="utf8"
      src="https://code.jquery.com/jquery-3.6.0.min.js"
    ></script>
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"
    ></script>
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js"
    ></script>
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.html5.min.js"
    ></script>
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"
    ></script>
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"
    ></script>
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"
    ></script>
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.print.min.js"
    ></script>
    <style>
  #example {
    width: 100%;
    max-width: 100%; /* To prevent table from overflowing its container */
  }

  .table-responsive {
    overflow-x: auto; /* Enable horizontal scrolling if the table is wider than the container */
  }
  .navbar-color {
    background-color: #000000;
  }
</style>
  </head>
<body class="bg-light">
    <main>
      <nav
        class="navbar navbar-expand-lg navbar-dark navbar-color bg-gradient"
        id="topNavBar"
      >
        <div class="container">
          <a class="navbar-brand" href="./audit_log.html">
            
            
            <img
              src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10%' height='auto' viewBox='0 0 337 43' class='global-navigation__logo'%3E%3Cpath id='path1' d='M8.43243 42H0L30 2V12.8502L8.43243 42Z' fill='white'%3E%3C/path%3E%3Cpath id='path2' d='M11 42H19.2821L30 27.3333V16L11 42Z' fill='white'%3E%3C/path%3E%3Cpath id='path3' d='M30.4324 42H22L52 2V12.8502L30.4324 42Z' fill='white'%3E%3C/path%3E%3Cpath id='path4' d='M33 42H41.2821L52 27.3333V16L33 42Z' fill='white'%3E%3C/path%3E%3Cpath id='path5' d='M44 42H52V31L44 42Z' fill='white'%3E%3C/path%3E%3Cpath id='path6' d='M78.0086 0H66.7714V41.04H73.7743V7.00286H73.9372L86.4771 41.04H91.5257L104.066 7.00286V41.04H111.069V0H99.9943L88.92 28.8257L78.0086 0Z' fill='white'%3E%3C/path%3E%3Cpath id='path7' d='M129.471 12.54C125.074 12.54 120.677 13.8429 117.583 17.1L121.166 20.6829C122.957 18.8914 125.726 17.7514 128.657 17.7514C132.403 17.7514 135.009 19.5429 135.009 22.9629V23.7772H133.38C126.377 23.7772 115.791 24.4286 115.791 33.5486C115.791 39.0857 120.84 41.8543 125.889 41.8543C129.634 41.8543 132.891 40.5514 134.846 37.2943H135.009V41.04H141.523V25.08C141.523 21.1714 141.523 12.54 129.471 12.54Z' fill='white'%3E%3C/path%3E%3Cpath id='path8' d='M154.551 13.1914H147.874V41.04H154.877V25.8943C154.877 22.1486 156.669 18.8914 161.229 18.8914C166.114 18.8914 166.277 23.94 166.277 27.0343V41.2029H173.28V23.4514C173.28 17.7514 170.674 12.54 163.183 12.54C158.46 12.54 155.854 14.9829 154.714 17.7514H154.551V13.1914' fill='white'%3E%3C/path%3E%3Cpath id='path9' d='M186.96 17.1C188.263 14.82 191.031 12.54 195.266 12.54C202.757 12.54 205.363 17.7514 205.363 23.4514V41.04H198.523V26.8714C198.523 23.7771 198.197 18.7286 193.474 18.7286C188.914 18.7286 187.123 22.1486 187.123 25.8943V41.04H180.12V0H187.123L186.96 17.1' fill='white'%3E%3C/path%3E%3Cpath id='path10' d='M223.929 12.54C219.531 12.54 215.134 13.8429 212.04 17.1L215.623 20.6829C217.414 18.8914 220.183 17.7514 223.114 17.7514C226.86 17.7514 229.466 19.5429 229.466 22.9629V23.7772H227.837C220.834 23.7772 210.249 24.4286 210.249 33.5486C210.249 39.0857 215.297 41.8543 220.346 41.8543C224.091 41.8543 227.349 40.5514 229.303 37.2943H229.466V41.04H235.654V25.08C235.98 21.1714 235.98 12.54 223.929 12.54ZM229.303 30.1286C229.303 34.0372 227.023 36.48 222.3 36.48C220.02 36.48 217.414 35.34 217.414 32.8972C217.414 28.8257 224.091 28.6629 227.837 28.6629H229.303V30.1286' fill='white'%3E%3C/path%3E%3Cpath id='path11' d='M240.051 19.2172L249.986 5.21145V13.3543H258.617L254.383 19.2172H249.823V31.4314C249.823 34.2 250.637 35.9914 253.731 35.9914C255.034 35.9914 256.663 35.8286 257.477 35.1772V41.04C256.011 41.6915 253.569 42.0172 251.94 42.0172C244.611 42.0172 242.82 38.76 242.82 32.0829V19.38L240.051 19.2172' fill='white'%3E%3C/path%3E%3Cpath id='path12' d='M268.389 5.21145L258.454 19.2172H261.549V31.92C261.549 38.4343 263.34 41.8543 270.669 41.8543C272.297 41.8543 274.74 41.6914 276.206 40.8772V35.0143C275.391 35.6657 273.6 35.8286 272.46 35.8286C269.366 35.8286 268.551 34.0372 268.551 31.2686V19.0543H276.206V13.1914H268.551V5.21145H268.389Z' fill='white'%3E%3C/path%3E%3Cpath id='path13' d='M292.98 12.54C288.583 12.54 284.186 13.8429 281.091 17.1L284.674 20.6829C286.629 18.8914 289.234 17.7514 292.166 17.7514C295.911 17.7514 298.517 19.5429 298.517 22.9629V23.7772H296.726C289.723 23.7772 279.137 24.4286 279.137 33.5486C279.137 39.0857 284.186 41.8543 289.234 41.8543C292.98 41.8543 296.237 40.5514 298.191 37.2943H298.354V41.04H304.543V25.08C305.031 21.1714 305.031 12.54 292.98 12.54ZM298.354 30.1286C298.354 34.0372 296.074 36.48 291.351 36.48C289.071 36.48 286.466 35.34 286.466 32.8972C286.466 28.8257 293.143 28.6629 296.889 28.6629H298.354V30.1286' fill='white'%3E%3C/path%3E%3Cpath id='path14' d='M317.734 13.1914H311.057V41.04H318.06V25.8943C318.06 22.1486 319.851 18.8914 324.411 18.8914C329.297 18.8914 329.46 23.94 329.46 27.0343V41.2029H336.463V23.4514C336.463 17.7514 333.694 12.54 326.366 12.54C321.643 12.54 319.037 14.9829 317.897 17.7514H317.734V13.1914' fill='white'%3E%3C/path%3E%3C/svg%3E"
              alt="Audit Trailing"
              width="100"
              height="auto"
            />
          
          
          </a>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="./audit_log.html"
                  ><i class="fa fa-home"></i>Home</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="./audit_stats.html"
                  ><i class="fa fa-th-list"></i>Statistics</a
                >
              </li>
            </ul>
          </div>
          <div>
            <div>
              <ul class="navbar-nav">
                <li>
                  <a class="nav-link" href="./login.html"
                    >Logout</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>
      </nav>
      <div class="container py-5">
        <div class="d-flex w-100">
          <h3 class="col-auto flex-grow-1"><b>Audit Trail</b></h3>
        </div>
        <hr />
        <div class="card">
          <div class="card-body">
  <body>  
    <div class="table-responsive">
    <table id="example" class="display">
      <thead>
        <tr>
          <th>Change</th>
          <th>UserId</th>
          <th>CreatedBy</th>
          <th>UpdatedBy</th>
          <th>PrimaryOrgId</th>
          <th>CreatedTimestamp</th>
          <th>UpdatedTimestamp</th>
        </tr>
      </thead>
      <tbody id="table-body">
        <!-- JSON data will be inserted here -->
      </tbody>
    </table>
</div>
    <!-- Bootstrap Modal for Additional Information -->
    <div
      class="modal fade"
      id="additionalInfoModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <!-- Moved the tabs here -->
            <ul class="nav nav-tabs" id="infoTabs" role="tablist">
              <li class="nav-item">
                <a
                  class="nav-link active"
                  id="tab1-tab"
                  data-toggle="tab"
                  href="#tab1"
                  role="tab"
                  aria-controls="tab1"
                  aria-selected="true"
                  >Headers</a
                >
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  id="tab2-tab"
                  data-toggle="tab"
                  href="#tab2"
                  role="tab"
                  aria-controls="tab2"
                  aria-selected="false"
                  >Audit Meta Data</a
                >
              </li>
              <!-- Add more tabs as needed -->
            </ul>
            <h5 class="modal-title ml-2" id="exampleModalLabel">
              Additional Information
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <!-- Tab panes -->
            <div class="tab-content" id="infoTabContent">
              <!-- Tab 1 content -->
              <div
                class="tab-pane fade show active"
                id="tab1"
                role="tabpanel"
                aria-labelledby="tab1-tab"
              >
                <div class="table-responsive">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Key</th>
                        <th>Value</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Additional information for Tab 1 will be inserted here -->
                    </tbody>
                  </table>
                </div>
              </div>
              <!-- Tab 2 content -->
              <div
                class="tab-pane fade"
                id="tab2"
                role="tabpanel"
                aria-labelledby="tab2-tab"
              >
                <div class="table-responsive">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Key</th>
                        <th>Value</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Additional information for Tab 2 will be inserted here -->
                    </tbody>
                  </table>
                </div>
              </div>
              <!-- Add more tab content as needed -->
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

<script>
      $(document).ready(function () {
        // Fetch JSON data from the provided URL
        fetch("https://run.mocky.io/v3/ba12d051-8f60-40c4-a9bd-6b2478d3b6ca")
          .then((response) => response.json())
          .then((data) => {
            // Access the "data" array within the JSON
            const jsonData = data.data;

            // Create rows from JSON data
            const tableBody = document.getElementById("table-body");
            jsonData.forEach((item, index) => {
              tableBody.innerHTML += `
                        <tr data-toggle="modal" data-target="#additionalInfoModal" data-index="${index}">
                            <td>${item.TypeOfChange || ""}</td>
                            <td>${item.EntityPayload?.UserId || ""}</td>
                            <td>${item.EntityPayload?.CreatedBy || ""}</td>
                            <td>${item.EntityPayload?.UpdatedBy || ""}</td>
                            <td>${item.EntityPayload?.PrimaryOrgId || ""}</td>
                            <td>${
                              item.EntityPayload?.CreatedTimestamp || ""
                            }</td>
                            <td>${
                              item.EntityPayload?.UpdatedTimestamp || ""
                            }</td>
                        `;
            });

            // Initialize DataTable with Buttons
            $("#example").DataTable({
              paging: true,
              searching: true,
              ordering: true,
              buttons: ["csv", "excel", "pdf", "print"],
              responsive: true,
              dom: "Bfrtip",
              // Add more options as needed
            });

            // Handle the click event to populate the modal with additional information
            $("#example tbody").on("click", "tr", function () {
              const index = $(this).data("index");
              const additionalInfo = jsonData[index].AdditionalInfo || {};
              const auditMetaData = jsonData[index].AuditMetaData || {};
              const modalBody = document.querySelector(".modal-body");

              // Access the "headers" object from JSON data
              const headers = jsonData[index].headers;

              // Create another table for additional information
              modalBody.innerHTML = `
        <!-- Tab panes -->
        <div class="tab-content" id="infoTabContent">
            <!-- Tab 1 content -->
            <div class="tab-pane fade show active" id="tab1" role="tabpanel" aria-labelledby="tab1-tab">
                <div class="table-responsive">
                    <table id="additionalTable1" class="table">
                        <thead>
                            <tr>
                                <th>Key</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(headers)
                              .map(
                                ([key, value]) => `
                                <tr>
                                    <td>${key}</td>
                                    <td>${value}</td>
                                </tr>
                            `
                              )
                              .join("")}
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- Tab 2 content -->
            <div class="tab-pane fade" id="tab2" role="tabpanel" aria-labelledby="tab2-tab">
                <div class="table-responsive">
                    <table id="additionalTable2" class="table">
                        <thead>
                            <tr>
                                <th>Key</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                                <tr>
                                    <td>EntityType</td>
                                    <td>${auditMetaData.EntityType || ""}</td>
                                </tr>
                                <tr>
                                    <td>SourceComponentCode</td>
                                    <td>${
                                      auditMetaData.SourceComponentCode || ""
                                    }</td>
                                </tr>
                                <tr>
                                    <td>Organization</td>
                                    <td>${auditMetaData.Organization || ""}</td>
                                </tr>
                                <tr>
                                    <td>User</td>
                                    <td>${auditMetaData.User || ""}</td>
                                </tr>
                                <tr>
                                    <td>EntityName</td>
                                    <td>${auditMetaData.EntityName || ""}</td>
                                </tr>
                                <tr>
                                    <td>SourceComponent</td>
                                    <td>${
                                      auditMetaData.SourceComponent || ""
                                    }</td>
                                </tr>
                                <tr>
                                    <td>SourceType</td>
                                    <td>${auditMetaData.SourceType || ""}</td>
                                </tr>
                                <tr>
                                    <td>Source</td>
                                    <td>${auditMetaData.Source || ""}</td>
                                </tr>
                                <tr>
                                    <td>AuditIndexSuffix</td>
                                    <td>${
                                      auditMetaData.AuditIndexSuffix || ""
                                    }</td>
                                </tr>
                            <!-- Add more rows for other properties -->
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- Add more tab content as needed -->
        </div>
    `;

    $("#additionalTable1").DataTable({
              paging: false,
              searching: false,
              ordering: false,
              buttons: ["csv", "excel", "pdf", "print"],
              responsive: true,
              dom: "Bfrtip",
              // Add more options as needed
            });
            $("#additionalTable2").DataTable({
              paging: false,
              searching: false,
              ordering: false,
              buttons: ["csv", "excel", "pdf", "print"],
              responsive: true,
              dom: "Bfrtip",
              // Add more options as needed
            });
              // Refresh the tab content after updating it
              $('#infoTabs a[data-toggle="tab"]').on(
                "shown.bs.tab",
                function (e) {
                  $("#infoTabContent .tab-pane.active").html("Loading...");

                  const tabId = $(e.target).attr("href").replace("#", "");
                  const tabContent = document.querySelector(
                    `#${tabId} .table tbody`
                  );

                  if (tabId === "tab1") {
                    // Populate Tab 1 content here if needed
                  } else if (tabId === "tab2") {
                    // Access the "AuditMetaData" object from JSON data for Tab 2
                    const auditMetaData = jsonData[index].AuditMetaData || {};

                    // Populate Tab 2 content with AuditMetaData
                    tabContent.innerHTML = `
                                <tr>
                                    <td>EntityType</td>
                                    <td>${auditMetaData.EntityType || ""}</td>
                                </tr>
                                <tr>
                                    <td>SourceComponentCode</td>
                                    <td>${
                                      auditMetaData.SourceComponentCode || ""
                                    }</td>
                                </tr>
                                <tr>
                                    <td>Organization</td>
                                    <td>${auditMetaData.Organization || ""}</td>
                                </tr>
                                <tr>
                                    <td>User</td>
                                    <td>${auditMetaData.User || ""}</td>
                                </tr>
                                <tr>
                                    <td>EntityName</td>
                                    <td>${auditMetaData.EntityName || ""}</td>
                                </tr>
                                <tr>
                                    <td>SourceComponent</td>
                                    <td>${
                                      auditMetaData.SourceComponent || ""
                                    }</td>
                                </tr>
                                <tr>
                                    <td>SourceType</td>
                                    <td>${auditMetaData.SourceType || ""}</td>
                                </tr>
                                <tr>
                                    <td>Source</td>
                                    <td>${auditMetaData.Source || ""}</td>
                                </tr>
                                <tr>
                                    <td>AuditIndexSuffix</td>
                                    <td>${
                                      auditMetaData.AuditIndexSuffix || ""
                                    }</td>
                                </tr>
                                <!-- Add more rows for other properties -->
                            `;
                  }
                }
              );
            });
          })
          .catch((error) => {
            console.error("Error fetching JSON data:", error);
          });
      });
    </script>
    </main>
  </body>
</html>
